<!DOCTYPE HTML>
<html>
<head>
  <meta charset="UTF-8">
  <title>Receptdatabsen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="/hourglass_loader.css" rel="stylesheet">
  <link href="/fonts.css" rel="stylesheet">
  <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
  <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
  <script type="module" src="https://unpkg.com/stencil-quill@latest/dist/quill-components/quill-components.esm.js"></script>
  <script nomodule="" src="https://unpkg.com/stencil-quill@latest/dist/quill-components/quill-components.js"></script>
  <script src="/main.js"></script>
</head>

<body>
  <div id="elm"></div>
  <script type="text/javascript">
    var flags = {width: window.innerWidth, height: window.innerHeight};
    var app = Elm.Main.init({
      node: document.getElementById('elm'),
      flags: flags
    });

    // Quill custom event relay to Elm port
    Quill.register('modules/elm-port', function(quill, options) {
      quill.on('text-change', function(delta, oldDelta, source) {
        var payload = { "delta": delta, "oldDelta": oldDelta, "source": source, "text": quill.getText() }
        // Prevent infinite loops by checking source
        if (source != 'api') {
          console.debug(payload);
          app.ports.portReceiver.send(payload);
        }
      });

      app.ports.portSender.subscribe(function(elmValue) {
        console.debug("elmValue from Elm!: ", elmValue);
        //quill.formatText(0, 5, { 'bold': true, 'color': 'blue' });
        quill.setContents(elmValue);
      })
    });

  </script>
</body>
</html>
